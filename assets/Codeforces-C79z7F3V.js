import{L as E,d as P,s as j,C as O,v as m,F as k,o as f,e as y,g as B,f as _,t as $,h as D,i as V,P as p,V as L,D as x}from"./index-CYbdUtQ1.js";import{l as F}from"./load-Bav7-mWT.js";import{c as H}from"./codeforces-BeZ4E3OT.js";import{_ as M,h as J,f as G}from"./Contest-CLhbfCWe.js";import"./c-table-rbIyLGR-.js";import"./user-link-BLGhVy6a.js";import"./cf-rating-color-Q-cPL10X.js";import"./nc-rating-color-Bld4FLJR.js";function K(){const o=E("loading");return{start(){o.value=!0},end(){o.value=!1}}}const W=F(H),S=new Map;for(const o of W)o.type.startsWith("codeforces")&&S.set(o.id,o);function q(o){return S.get(+o)??null}const C="https://codeforces.com/api/",z={key:0},Q={key:1,class:"divide-y"},X=_("h2",{class:"mb-2"},"错误",-1),Y={class:"pt-2"},ie=P({__name:"Codeforces",setup(o){const h=j(),I=O(),r=m(null),d=m(!1),T=m(!1),{start:N,end:w}=K(),l=m(!1),u=async s=>{if(l.value)return;l.value=!0;const n=new URL(C+"contest.standings");n.searchParams.append("contestId",""+s.id),n.searchParams.append("handles",J.map(({h:e})=>e).join(";")),n.searchParams.append("showUnofficial","true");const{result:a}=await(await fetch(n.toString())).json();let i=0;s.problems=a.problems;for(const e of a.problems)e.problemUrl=`https://codeforces.com/contest/${e.contestId}/problem/${e.index}`;s.standings=[];for(const e of a.rows){if(e.party.participantType!==p.CONTESTANT&&e.party.participantType!==p.VIRTUAL&&e.party.participantType!==p.OUT_OF_COMPETITION&&e.party.participantType!==p.PRACTICE)continue;e.party.participantType!==p.PRACTICE&&i++;const U=e.problemResults.reduce((t,c)=>c.points===0?t:t+(c.bestSubmissionTimeSeconds??0)+20*(c.rejectedAttemptCount??0),0),v=e.party.participantTime??s.startTime;s.standings.push({author:{members:e.party.members.map(t=>t.handle),teamName:e.party.teamName??G(e.party.members[0].handle),participantTime:v,participantType:e.party.participantType},rank:e.rank,solved:e.problemResults.filter(t=>t.points>0).length,penalty:U,submissions:e.problemResults.map((t,c)=>{const b=t.bestSubmissionTimeSeconds+v,g=t.bestSubmissionTimeSeconds;return t.points>0?{id:-1,creationTime:b,relativeTime:g,problemIndex:c,verdict:L.OK,dirty:t.rejectedAttemptCount}:t.rejectedAttemptCount>0?{id:-1,creationTime:b,relativeTime:g,problemIndex:c,dirty:t.rejectedAttemptCount}:null}).filter(t=>t!==null)})}s.participantNumber=i,l.value=!1},R=async s=>{const n=new URL(C+"contest.list"),a="codeforces/contest.list",{result:i}=sessionStorage.getItem(a)?{result:JSON.parse(sessionStorage.getItem(a))}:await(await fetch(n.toString())).json();sessionStorage.getItem(a)||sessionStorage.setItem(a,JSON.stringify(i));for(const e of i)if(e.id===s)return{type:"codeforces",name:e.name,startTime:e.startTimeSeconds,duration:e.durationSeconds,participantNumber:0,id:e.id,phase:e.phase,contestUrl:`https://codeforces.com/contest/${e.id}`,standingsUrl:`https://codeforces.com/contest/${e.id}/standings`}},A=()=>{u(r.value)};return k(()=>h.params,async s=>{if(s.id){N();const n=q(+s.id);if(n!==null)r.value=n,await u(r.value),document.title=`${n.name} - CPany`;else{const a=await R(+s.id);if(a)T.value=!0,r.value=a,await u(r.value),document.title=`${a.name} - CPany`;else{d.value=!0;const e=setTimeout(()=>I.replace({name:"Home"}),3e3);x(()=>clearTimeout(e))}}w()}},{immediate:!0}),(s,n)=>(f(),y("div",null,[r.value&&!d.value?(f(),y("div",z,[B(M,{contest:r.value,dynamic:T.value,onRefresh:A},null,8,["contest","dynamic"])])):d.value?(f(),y("div",Q,[X,_("p",Y,"未找到 ID 为 "+$(D(h).params.id)+" 的 Codeforces 比赛",1)])):V("v-if",!0)]))}});export{ie as default};
